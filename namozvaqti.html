<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ•Œ O'zbekiston Ramazon Taqvimi va Namoz Vaqtlari</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
    --color-primary: #008f5a;   /* Yashil (Asosiy) */
    --color-secondary: #FFC000; /* Oltin Sariq (Urg'u beruvchi) */
    --color-navy: #1f334a;      /* To'q Moviy (Fon) */
    --color-light: #FFFFFF;     /* Oq (Matn) */
    --color-bg-dark: #122033;   /* Chuqur Fon */
}

/* Global Uslublar (O'qishga qulaylik) */
body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 0;
    color: var(--color-light);
    background: linear-gradient(135deg, var(--color-navy) 0%, var(--color-bg-dark) 100%);
    min-height: 100vh;
    line-height: 1.8; /* Qatorlar oralig'ini oshirish */
    font-size: 18px; /* Asosiy shrift hajmini oshirish */
    /* Yangi: Silliq skroll */
    scroll-behavior: smooth; 
}

h1, h2, h3 {
    color: var(--color-secondary);
    margin-top: 0.5em;
    margin-bottom: 0.5em;
}
h2 { font-size: 2.2em; }
h3 { font-size: 1.8em; }

.container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 20px;
}

/* Glassmorphism/Karta Effekti (Tinch ranglarda) */
.glass-card {
    background: rgba(255, 255, 255, 0.08);
    border-radius: 15px;
    backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

/* Header va Navigatsiya */
header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 40px;
    background: var(--color-navy);
    box-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
    /* Yangi: Tepada qotirish */
    position: sticky; 
    top: 0; 
    z-index: 100; /* Boshqa elementlardan ustun turishi uchun */
}
.logo { font-size: 1.8em; }
nav a {
    color: var(--color-light);
    text-decoration: none;
    margin-left: 20px;
    font-weight: 600;
    font-size: 1.1em;
    padding: 5px 10px;
}
nav a:hover {
    color: var(--color-secondary);
}

/* Tugmalar va Forma Elementlari */
.btn {
    padding: 15px 30px; /* Kattaroq tugmalar */
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 700;
    text-transform: uppercase;
    font-size: 1em;
    margin: 10px 10px 10px 0;
    display: inline-block;
}
.btn-primary {
    background-color: var(--color-primary);
    color: var(--color-navy);
}
.btn-telegram {
    background-color: #0088cc; /* Telegram ko'k */
    color: var(--color-light);
}
.dropdown {
    padding: 12px;
    border-radius: 8px;
    border: 1px solid var(--color-primary);
    background-color: rgba(255, 255, 255, 0.1);
    color: var(--color-light);
    font-size: 1em;
    cursor: pointer;
}
.dropdown option {
    background-color: var(--color-navy); /* Option fonini to'q qilish */
}

/* Modal Uslubi */
.modal {
    z-index: 1000;
}
.modal-content {
    max-width: 500px;
    text-align: center;
}
.large-text {
    font-size: 1.2em;
    font-weight: 600;
    color: var(--color-secondary);
}
.small-text {
    font-size: 0.85em;
    color: #aaa;
    margin-top: 15px;
}

/* Namoz Vaqtlari va Countdown */
.prayer-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}
.location-control label {
    font-weight: 600;
    margin-right: 10px;
}
.countdown-timers {
    display: flex;
    gap: 25px;
    margin: 30px 0;
}
.large-timer {
    padding: 30px;
    flex: 1;
}
.countdown-display {
    font-size: 3.5em; /* Juda katta va aniq vaqt */
    color: var(--color-secondary);
    font-weight: 700;
    letter-spacing: 2px;
}

/* Umumiy Jadval Uslubi */
.simple-table, .wide-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    font-size: 1.1em; /* Jadvaldagi shrift kattaligi */
}
.simple-table th, .simple-table td, 
.wide-table th, .wide-table td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.simple-table th, .wide-table th {
    background-color: rgba(0, 143, 90, 0.2);
    color: var(--color-secondary);
    font-weight: 600;
}
.simple-table td:last-child {
    text-align: right;
    font-weight: 700;
    color: var(--color-primary);
}

/* Ramazon Info Grid */
.ramadan-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}
.info-item strong {
    color: var(--color-secondary);
}

/* Maxsus holatlar */
.hidden {
    display: none;
}
.hidden-timer {
    display: none;
}
.special-day {
    font-weight: 700;
    color: #ffd933; /* Yorqin Oltin */
    background: rgba(255, 215, 0, 0.15);
    border-radius: 5px;
    padding: 2px 5px;
}
.current-prayer {
    background: var(--color-primary); 
    color: var(--color-navy) !important; 
    font-weight: bold;
}

/* Responsive (Kichik ekranlar uchun) */
@media (max-width: 768px) {
    body { font-size: 16px; }
    header { flex-direction: column; }
    nav a { margin: 5px 10px; }
    .prayer-header { flex-direction: column; align-items: flex-start; }
    .countdown-timers { flex-direction: column; }
    .countdown-display { font-size: 3em; }
    .btn { width: 90%; margin: 10px auto; display: block; }
}
    </style>
</head>
<body>

    <div id="subscription-modal" class="modal">
        <div class="modal-content glass-card">
            <h2>Saytga Kirish ðŸ”’</h2>
            <p class="large-text"><strong>Saytni ochish uchun bizning Telegram kanalimizga obuna boâ€˜ling.</strong></p>
            <p>Telegram kanalimiz: <strong class="telegram-id">@Raimjonov_28</strong></p>
            <a href="https://t.me/Raimjonov_28" target="_blank" class="btn btn-telegram">1. Telegramga O'tish</a>
            <button id="verify-subscription" class="btn btn-primary" disabled>2. Obunani Tasdiqlash</button>
            <p class="small-text">*Majburiy qadam. Avval Telegramga o'tib, 5 soniya kuting.</p>
        </div>
    </div>

    <div id="main-content" class="hidden">
        
        <header id="main-header">
            <h1 class="logo">Oson Taqvim ðŸ•Œ</h1>
            <nav>
                <a href="#namoz">Namoz Vaqtlari</a>
                <a href="#taqvim">Ramazon Jadvali</a>
            </nav>
        </header>

        <main class="container">

            <section id="namoz" class="prayer-times-section">
                <div class="prayer-header">
                    <h2 class="section-title">Bugungi namoz vaqtlari <span id="current-city-name">(Samarqand)</span></h2>
                    
                    <div class="location-control">
                        <label for="location-selector">Viloyatni tanlang:</label>
                        <select id="location-selector" class="dropdown">
                            </select>
                    </div>
                </div>

                <div class="countdown-timers">
                    <div class="timer-card glass-card large-timer">
                        <p>Keyingi vaqtgacha qoldi:</p>
                        <div id="next-prayer-countdown" class="countdown-display">00:00:00</div>
                    </div>
                    
                    <div id="iftar-countdown-card" class="timer-card glass-card hidden-timer large-timer">
                        <p>Iftorlikgacha qoldi:</p>
                        <div id="iftar-countdown" class="countdown-display">--:--:--</div>
                    </div>
                </div>

                <div class="prayer-table-container glass-card">
                    <table class="simple-table">
                        <thead><tr><th>Namoz nomi</th><th>Vaqti</th></tr></thead>
                        <tbody id="prayer-times-body">
                            <tr><td>Saharlik (Tong)</td><td data-time="Imsak">--:--</td></tr>
                            <tr><td>Bomdod</td><td data-time="Fajr">--:--</td></tr>
                            <tr><td>Quyosh</td><td data-time="Sunrise">--:--</td></tr>
                            <tr><td>Peshin</td><td data-time="Dhuhr">--:--</td></tr>
                            <tr><td>Asr</td><td data-time="Asr">--:--</td></tr>
                            <tr><td>Shom (Iftor)</td><td data-time="Maghrib">--:--</td></tr>
                            <tr><td>Xufton</td><td data-time="Isha">--:--</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
            
            <hr>

            <section id="taqvim">
                <div class="taqvim-controls glass-card">
                    <h2>ðŸ—“ Ramazon Taqvimi (2026-yil)</h2>
                    
                    <div id="ramadan-info" class="ramadan-info-grid">
                        <div class="info-item"><strong>Boshlanish:</strong> <span id="start-date">18 Fevral</span></div>
                        <div class="info-item"><strong>Tugash:</strong> <span id="end-date">19 Mart</span></div>
                        <div class="info-item"><strong>Roâ€˜za kuni:</strong> <span id="fast-days">--</span></div>
                        <div class="info-item"><strong>Yil tanlash:</strong> 
                            <select id="year-selector" class="dropdown small-dropdown">
                                </select>
                        </div>
                    </div>
                    <p class="ramadan-note">* Namoz vaqtlarining farqi har bir viloyat markazi uchun taxminan +/- 1-5 daqiqa boâ€˜lishi mumkin.</p>
                </div>
                

                <div class="taqvim-table-container glass-card">
                    <h3>Roâ€˜za kunlari jadvali</h3>
                    <table id="ramadan-calendar" class="wide-table">
                        <thead>
                            <tr>
                                <th>Roâ€˜za Kuni</th>
                                <th>Sanasi</th>
                                <th>Saharlik (Imsak)</th>
                                <th>Iftorlik (Shom)</th>
                                <th>Izoh</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </section>

        </main>

        <footer>
            <div class="container">
                <p>&copy; 2025. Barcha huquqlar himoyalangan. Dasturchi: <a href="https://t.me/Raimjonov_28" target="_blank">@Raimjonov_28</a></p>
            </div>
        </footer>
    </div>

    <script>
                document.addEventListener('DOMContentLoaded', () => {

    const API_URL_BASE = 'https://api.aladhan.com/v1/';
    const locationSelector = document.getElementById('location-selector');

    // --- RAMAZON VAQTLARI (2026-yil) ---
    const RAMADAN_YEAR = 2026;
    const RAMADAN_START_DATE = new Date(2026, 1, 18); // Fevral 18
    const RAMADAN_END_DATE = new Date(2026, 2, 19);   // Mart 19

    // --- VILOYATLAR ---
    const UZBEK_CITIES = [
        { name: "Toshkent", value: "Tashkent" },
        { name: "Samarqand", value: "Samarkand" },
        { name: "Buxoro", value: "Bukhara" },
        { name: "Andijon", value: "Andijan" },
        { name: "Namangan", value: "Namangan" },
        { name: "Farg'ona", value: "Fergana" },
        { name: "Xiva", value: "Khiva" },
        { name: "Termiz", value: "Termez" },
        { name: "Qarshi", value: "Karshi" },
        { name: "Nukus", value: "Nukus" },
        { name: "Jizzax", value: "Jizzakh" },
        { name: "Urganch", value: "Urgench" }
    ];

    // --- STATIK ZAXIRA VAQTLAR ---
    const STATIC_PRAYER_TIMES = {
        Fajr: "06:04", Sunrise: "07:27", Dhuhr: "12:12", Asr: "15:14",
        Maghrib: "16:58", Isha: "18:19", Imsak: "05:45"
    };

    let lastNotifiedPrayer = '';
    let notificationPermission = Notification.permission;
    const audioAlert = new Audio('https://www.soundjay.com/buttons/beep-01a.mp3');

    // MODAL
    const modal = document.getElementById('subscription-modal');
    const mainContent = document.getElementById('main-content');
    const verifyButton = document.getElementById('verify-subscription');
    const telegramLink = document.querySelector('.btn-telegram');

    function checkSubscriptionStatus() {
        const lastVerifiedTime = localStorage.getItem('lastVerifiedTime');
        const now = Date.now();
        const VALID_DURATION = 86400000;

        if (lastVerifiedTime && (now - lastVerifiedTime < VALID_DURATION)) {
            return true;
        }
        localStorage.removeItem('lastVerifiedTime');
        localStorage.removeItem('hasClickedTelegram');
        return false;
    }

    let hasClickedTelegram = localStorage.getItem('hasClickedTelegram') === 'true';
    let isSubscribed = checkSubscriptionStatus();

    if (!isSubscribed) {
        modal.classList.remove('hidden');
        mainContent.classList.add('hidden');
        if (!hasClickedTelegram) {
            verifyButton.disabled = true;
            verifyButton.textContent = "2. Telegramga o'ting";
        }
    } else {
        modal.classList.add('hidden');
        mainContent.classList.remove('hidden');
        initMainFunctions();
    }

    telegramLink.addEventListener('click', () => {
        if (!hasClickedTelegram) {
            localStorage.setItem('hasClickedTelegram', 'true');
            hasClickedTelegram = true;

            verifyButton.textContent = "Iltimos 5 soniya kuting...";
            verifyButton.disabled = true;

            setTimeout(() => {
                verifyButton.disabled = false;
                verifyButton.textContent = "Obunani tasdiqlash";
            }, 5000);
        }
    });

    verifyButton.addEventListener('click', () => {
        if (verifyButton.disabled) return;

        if (hasClickedTelegram) {
            localStorage.setItem('lastVerifiedTime', Date.now());
            modal.classList.add('hidden');
            mainContent.classList.remove('hidden');
            initMainFunctions();
            requestNotificationPermission();
            alert("Muvaffaqiyatli! Saytdan foydalanishingiz mumkin.");
        }
    });

    function requestNotificationPermission() {
        if ('Notification' in window && Notification.permission !== 'granted') {
            Notification.requestPermission().then(p => {
                notificationPermission = p;
            });
        }
    }

    // ASOSIY FUNKSIYALAR
    function initMainFunctions() {
        populateSelectors();
        setupEventListeners();

        generateRamadanCalendar(RAMADAN_YEAR);
        fetchPrayerTimes();
        setInterval(updateCountdown, 1000);
    }

    function populateSelectors() {
        UZBEK_CITIES.forEach(city => {
            const opt = document.createElement('option');
            opt.value = city.value;
            opt.textContent = city.name;
            if (city.value === "Samarkand") opt.selected = true;
            locationSelector.appendChild(opt);
        });

        const yearSelector = document.getElementById('year-selector');
        for (let y = 2025; y <= 2050; y++) {
            const opt = document.createElement('option');
            opt.value = y;
            opt.textContent = y;
            if (y === RAMADAN_YEAR) opt.selected = true;
            yearSelector.appendChild(opt);
        }
    }

    function setupEventListeners() {
        document.getElementById('year-selector').addEventListener('change', e => {
            generateRamadanCalendar(e.target.value);
        });

        locationSelector.addEventListener('change', () => {
            fetchPrayerTimes();
            generateRamadanCalendar(document.getElementById('year-selector').value);
        });
    }

    // RAMAZON TAQVIMI
    async function generateRamadanCalendar(year) {
        const body = document.querySelector('#ramadan-calendar tbody');
        body.innerHTML = '';

        if (parseInt(year) !== RAMADAN_YEAR) {
            body.innerHTML = `<tr><td colspan="5">Bu yil uchun ma'lumot yo'q</td></tr>`;
            return;
        }

        const start = new Date(RAMADAN_START_DATE);
        const end = new Date(RAMADAN_END_DATE);
        const days = Math.round((end - start) / (1000 * 3600 * 24)) + 1;
        const loc = locationSelector.value;

        for (let i = 0; i < days; i++) {
            const date = new Date(start);
            date.setDate(start.getDate() + i);

            const iso = date.toLocaleDateString("en-CA");

            const api = `${API_URL_BASE}timingsByCity?city=${loc}&country=Uzbekistan&method=1&date=${iso}`;

            let iftor = STATIC_PRAYER_TIMES.Maghrib;
            let imsak = STATIC_PRAYER_TIMES.Imsak;

            try {
                const res = await fetch(api);
                const data = await res.json();

                if (data.code === 200) {
                    iftor = data.data.timings.Maghrib.substring(0, 5);
                    imsak = data.data.timings.Imsak.substring(0, 5);
                }
            } catch { }

            const row = body.insertRow();
            row.innerHTML = `
                <td>${i + 1}-kun</td>
                <td>${date.toLocaleDateString("uz-UZ", { month: "long", day: "numeric" })}</td>
                <td>${imsak}</td>
                <td>${iftor}</td>
                <td></td>
            `;
        }
    }

    // BUGUNGI NAMOZ VAQTLARI
    async function fetchPrayerTimes() {
        const loc = locationSelector.value;
        const name = locationSelector.options[locationSelector.selectedIndex].textContent;
        document.getElementById('current-city-name').textContent = `(${name})`;

        const date = new Date().toLocaleDateString("en-CA");
        const api = `${API_URL_BASE}timingsByCity?city=${loc}&country=Uzbekistan&method=1&date=${date}`;

        try {
            const res = await fetch(api);
            const data = await res.json();

            if (data.code === 200) {
                const t = data.data.timings;
                window.prayerTimings = {
                    Fajr: t.Fajr.substring(0, 5),
                    Sunrise: t.Sunrise.substring(0, 5),
                    Dhuhr: t.Dhuhr.substring(0, 5),
                    Asr: t.Asr.substring(0, 5),
                    Maghrib: t.Maghrib.substring(0, 5),
                    Isha: t.Isha.substring(0, 5),
                    Imsak: t.Imsak.substring(0, 5)
                };
                updatePrayerTimesUI(window.prayerTimings);
            }
        } catch {
            window.prayerTimings = STATIC_PRAYER_TIMES;
            updatePrayerTimesUI(STATIC_PRAYER_TIMES);
        }
    }

    function updatePrayerTimesUI(t) {
        document.querySelector('[data-time="Imsak"]').textContent = t.Imsak;
        document.querySelector('[data-time="Fajr"]').textContent = t.Fajr;
        document.querySelector('[data-time="Sunrise"]').textContent = t.Sunrise;
        document.querySelector('[data-time="Dhuhr"]').textContent = t.Dhuhr;
        document.querySelector('[data-time="Asr"]').textContent = t.Asr;
        document.querySelector('[data-time="Maghrib"]').textContent = t.Maghrib;
        document.querySelector('[data-time="Isha"]').textContent = t.Isha;
    }

    // VAQT SAXI
    function formatTime(ms) {
        const h = String(Math.floor(ms / 3600000)).padStart(2, '0');
        const m = String(Math.floor((ms % 3600000) / 60000)).padStart(2, '0');
        const s = String(Math.floor((ms % 60000) / 1000)).padStart(2, '0');
        return `${h}:${m}:${s}`;
    }

    function updateCountdown() {
        if (!window.prayerTimings) return;

        const now = new Date();
        const times = window.prayerTimings;
        const keys = ["Imsak", "Fajr", "Sunrise", "Dhuhr", "Asr", "Maghrib", "Isha"];

        let nextTime = null;
        let nextName = null;

        for (let k of keys) {
            const [h, m] = times[k].split(":");
            const t = new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m);

            const diff = t - now;

            if (diff > 0) {
                nextTime = t;
                nextName = k;
                break;
            }
        }

        if (!nextTime) {
            const [h, m] = times["Imsak"].split(":");
            nextTime = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, h, m);
            nextName = "Imsak";
        }

        const dx = nextTime - now;
        document.getElementById('next-prayer-countdown').textContent = formatTime(dx);
    }

});

    </script>
</body>
</html>
